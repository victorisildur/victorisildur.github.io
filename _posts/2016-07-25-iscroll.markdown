---
layout: post
title: "iscroll源码阅读"
date: 2016-07-25 08:27:00
categories: programming
---

## 为什么要读iscroll

这是我见过参数最多的一款插件，但更重要的是，它的效果非常好！

## 使用注意

iscroll依赖组件的宽高，这也是为什么要等onload之后才能初始化它。
推广思考，iscroll的部件不能hide起来，要自己想办法绕。

## eventType

IScroll类_init()时进行了事件监听，这是自然而然的，但它的eventType方法比较奇怪，来看下：

```javascript
_initEvents: function (remove) {
   var eventType = remove ? utils.removeEvent : utils.addEvent,
   target = this.options.bindToWrapper ? this.wrapper : window;

   eventType(window, 'orientationchange', this);
   ...
}

me.addEvent = function (el, type, fn, capture) {
   el.addEventListener(type, fn, !!capture);
};
```

看到了吗，`addEventListener(type, fn)`实际得到的fn是一个ISroll类对象，而不是一个function!
这是怎么回事呢？

通过下断点我们发现，`IScroll.prototype._move()`实际通过`IScroll.prototype._handleEvent()`调用。
去看w3c，这样是标准！：

>listener: The object that receives a notification (an object that implements the Event interface) when an event of the specified type occurs. This must be an object implementing the EventListener interface, or simply a JavaScript function

而EventListener Interface就是一个带handleEvent对象的方法！
嗯，确实比绑定纯函数方便那么一点。
