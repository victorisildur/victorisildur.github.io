<!DOCTYPE html>
<html>
  	<head>
  		<title>VictorIsildur's Blog</title>
  		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
  		<meta name="description" content="" />
  		<meta name="keywords" content="" />
  		<noscript>
  			<link rel="stylesheet" href="/css/skel.css" />
  			<link rel="stylesheet" href="/css/style.css" />
  			<link rel="stylesheet" href="/css/style-xlarge.css" />
  		</noscript>
  		<!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
  	</head>

	<body id="top">

      <header id="header">
          <a href="/" class="image avatar"><img src="/images/aragon.jpg" alt="" /></a>
          <h1><strong>I am <a href="https://github.com/victorisildur">VictorIsildur</a></strong>. First a programmer<br />
          Then a web coder<br />
      </header>


        <div id="main">
    <article>
        <header class="major">
            <h2 class="post-title">2015-06-19-【实习】新项目之前的思考</h2>
                <p class="post-meta">Jun 19, 2015</p>
        </header>

        <section>
            <h1>问题</h1>

<h2>速度问题</h2>

<p>smstream web速度遇到问题，原因总结下：
一是没有充分利用后端模板，全靠angularjs做渲染，这样文件大小倒没有变化很大，但依赖restful接口传数据，且数据需要各种拼接，耗时3秒
二是页面spa化严重，导致页面���胀，很多简单视图不得不去加载不需要的库和js
三是数据库结构有问题，params, calls什么的是把json字符串化之后存到一个字段里去的。这样导致每次取数据库的时候都要json load一次，非常耗时</p>

<h2>js问题</h2>

<p>js主要问题是数据操作相关的controller和视图显示/隐藏相关的逻辑混杂在了一起。
stackoverflow上大家建议的思路是把视图相关的js放到directive里去做，但directive一直没有搞清是怎么回事，template和link函数的作用。也就作罢了</p>

<h2>css问题</h2>

<p>css主要问题是用了过多的一揽子方案，如一揽子用bootstrap, 一揽子用semantic ui，导致文件大小惊人。淘宝网页的css就只有一个，js也是，非常精打细算。</p>

<h1>下次怎么办</h1>

<h2>后端</h2>

<p>同步架构滚粗，想用nodejs
不过需要解决：
1. 没有了shenma scripts怎么办  --&gt; 貌似只能nodejs写模块代替
2. 调用python? --&gt; 用命令行？ 那不是成了同步的了？
3. mongodb存储？ 主要是有没有线上资源给mongodb，本地随便搭一个自然简单</p>

<h2>前端</h2>

<ol>
<li>后端mvc为主，后端mvc为主！文件多了不害怕，数据多了ajax等害怕的！</li>
<li> js 视图逻辑和数据逻辑分开？ 啃directive? 应该看看网友的例子入门也还好。</li>
<li>less, 手动去简化bootstrap吧，虽然费时，但效果绝对nb。现在在改css上也没少花时间，还不如用less</li>
</ol>

<h1>最近干什么</h1>

<ol>
<li>mongodb不知道能不能用，所以还是先看看</li>
<li>nodejs 的 mvc不知道怎么搞，尽快搞个demo出来。带用户带应用的那种</li>
<li>angularjs directive不知道怎么搞，google别人的简易教程，书写的太渣渣了</li>
</ol>

<h1>试用反馈</h1>

<ul>
<li>tornado可以使用nginx做反向代理和静态文件服务器，提高处理能力</li>
</ul>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"> <span class="nx">http</span> <span class="p">{</span>
    <span class="nx">upstream</span> <span class="nx">frontends</span> <span class="p">{</span>
         <span class="nx">server</span> <span class="mf">10.181</span><span class="p">.</span><span class="mf">207.7</span><span class="err">:</span><span class="mi">8099</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">server</span> <span class="p">{</span>
         <span class="nx">listen</span> <span class="mi">8080</span><span class="p">;</span>
         <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
             <span class="nx">proxy_pass</span> <span class="na">http</span><span class="p">:</span><span class="c1">//frontends;</span>
         <span class="p">}</span>
         <span class="nx">location</span> <span class="o">/</span><span class="nx">scripts</span> <span class="p">{</span>
             <span class="nx">root</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">ha_pe_work</span><span class="o">/</span><span class="nx">sm_stream</span><span class="o">/</span><span class="nx">trunk</span><span class="o">/</span><span class="nx">web</span><span class="o">/</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="nx">location</span> <span class="o">/</span><span class="nx">resources</span> <span class="p">{</span>
             <span class="nx">root</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">ha_pe_work</span><span class="o">/</span><span class="nx">sm_stream</span><span class="o">/</span><span class="nx">trunk</span><span class="o">/</span><span class="nx">web</span><span class="o">/</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="nx">location</span> <span class="o">/</span><span class="nx">images</span><span class="o">/</span> <span class="p">{</span>
             <span class="nx">root</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">liuxu</span><span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="p">;</span>
         <span class="p">}</span>
     <span class="p">}</span>
</code></pre></div>
<p>这样的话/scripts, /resources 目录的请求都用nginx做静态文件服务器了，
其他请求则反向代理到了10.181.207.7:8099</p>

<ul>
<li>grunt-md5插件可以把 指定文件aaa.js转换成aaa-234rf23uh2u342342b34u23.js，放到指定目录</li>
<li>md5好像并没有什么卵用啊，文件引用处要引用aaa-234rf23uh2u342342b34u23.js全名好吗，有什么鬼用</li>
<li>最后还是用了requirejs的urlArgs选项，虽然是全部require用到的js都会加bust后缀，但可用性很强：</li>
</ul>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">requirejs</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
    <span class="p">...</span>
    <span class="na">urlArgs</span><span class="p">:</span> <span class="s1">'bust=20150624'</span>
    <span class="p">...</span>
<span class="p">})</span>
</code></pre></div>
<p>这样之后，app.js之后的所有请求就成这样了：
<img src="http://img.blog.csdn.net/20150624162211211" alt="urlArgs">
- requirejs之外的静态文件要更新该怎么办？tornado提供了static_url()方法：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span> <span class="nt">/&gt;</span>
</code></pre></div>
<p>干，不能用，貌似settings问题</p>

        </section>
        
        <footer>
            <div class="row">
            
            
                <article class="6u 12u(small) excerpt">
                    <header>
                        <h2><a href="/javascript/2015/06/11/%E9%9D%9E%E5%B8%B8%E7%AE%80%E5%8D%95%E7%9A%84js%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E6%A1%86%E6%9E%B6-%E4%B8%89-js-model%E9%BB%91%E7%A7%91%E6%8A%80.html">2015-06-11-非常简单的js双向数据绑定框架（三）：js model黑科技</a></h2>
                    </header>
                    <section>
                        <h1>初衷</h1>

<p>之前我们要在js域更新model，需要这样：</p>

                    </section>
                    <footer>
                        <ul class="actions">
                            <li><a href="/javascript/2015/06/11/%E9%9D%9E%E5%B8%B8%E7%AE%80%E5%8D%95%E7%9A%84js%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E6%A1%86%E6%9E%B6-%E4%B8%89-js-model%E9%BB%91%E7%A7%91%E6%8A%80.html" class="button">Read More</a></li>
                        </ul>
                    </footer>
                </article>
            
            
            
            
                <article class="6u$ 12u(small) excerpt f-right">
                    <header>
                        <h2><a href="/os/2015/06/24/epoll%E7%9A%84io%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8B%E4%B8%8Etornado%E7%9A%84%E5%85%B3%E7%B3%BB.html">2015-06-24-epoll的io异步模型与tornado的关系</a></h2>
                    </header>
                    <section>
                        <h1>初衷</h1>

<p>TORNADO IOLOOP: A level-triggered I/O loop.
```python
def connection<em>ready(sock, fd, events):
    while True:
        try:
            connection, address = sock.accept()
        except socket.error as e:
            if e.args[0] not in (errno.EWOULDBLOCK, errno.EAGAIN):
                raise
            return
        connection.setblocking(0)
        handle</em>connection(connection, address)</p>

                    </section>
                    <footer>
                        <ul class="actions">
                            <li><a href="/os/2015/06/24/epoll%E7%9A%84io%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8B%E4%B8%8Etornado%E7%9A%84%E5%85%B3%E7%B3%BB.html" class="button">Read More</a></li>
                        </ul>
                    </footer>
                </article>
            
            </div>
        </footer>

    </article>

</div>


        <!-- Footer -->
        <footer id="footer">
            <ul class="icons">

              
              <li>
                <a href="https://github.com/victorisildur" class="icon fa-github">
                  <span class="label">GitHub</span>
                </a>
              </li>
              

              
              <li>
                <a href="https://twitter.com/isi_liuxu" class="icon fa-twitter">
                  <span class="label">Twitter</span>
                </a>
              </li>
              

              
              <li>
                <a href="https://linkedin.com/in/xu-liu-4a617679" class="icon fa-linkedin">
                  <span class="label">LinkedIn</span>
                </a>
              </li>
              

              

              

              

              
              <li>
                <a href="mailto:isi_liuxu@yeah.net" class="icon fa-envelope-o">
                  <span class="label">Email</span>
                </a>
              </li>
              
            </ul>
            <ul class="copyright">
                <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
                <li>Images: <a href="https://unsplash.com/">Unsplash</a></li>
                <li>Jekyll Template: <a href="http://cloudcannon.com">Cloud Cannon</a></li>
            </ul>
        </footer>

  	<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
  	<script src="/js/jquery.min.js" defer="defer"></script>
  	<script src="/js/jquery.poptrox.min.js" defer="defer"></script>
  	<script src="/js/skel.min.js" defer="defer"></script>
  	<script src="/js/init.js" defer="defer"></script>
        <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
             (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                                  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

         ga('create', 'UA-82933111-1', 'auto');
         ga('send', 'pageview');
        </script>
	</body>
</html>
